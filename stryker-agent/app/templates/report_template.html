<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Mutation Test Report</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .card { border: 1px solid #ccc; border-radius: 8px; padding: 1em; margin-bottom: 1em; }
        .error { background-color: #ffdddd; border-left: 5px solid #f44336; }
        .success { background-color: #ddffdd; border-left: 5px solid #4CAF50; }
        h1, h2, h3 { color: #333; }
        code { background-color: #eee; padding: 2px 4px; border-radius: 4px; }
        pre { background-color: #f4f4f4; padding: 1em; border-radius: 4px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>AI Mutation Test Agent Report</h1>

    {% if state.error_message %}
    <div class="card error">
        <h2>Operation Failed</h2>
        <p>The agent encountered an error:</p>
        <pre>{{ state.error_message }}</pre>
    </div>
    {% else %}
    <div class="card">
        <h2>Summary</h2>
        <p><strong>Mutation Score:</strong> {{ "%.2f"|format(state.mutation_score) }}%</p>
        <p><strong>Survived Mutations Found:</strong> {{ state.survived_mutations|length }}</p>
        <p><strong>New Tests Generated:</strong> {{ state.generated_tests|length }}</p>
        {% if state.new_pr_url %}
        <p><strong>Corrective PR Created:</strong> <a href="{{ state.new_pr_url }}" target="_blank">{{ state.new_pr_url }}</a></p>
        {% elif state.survived_mutations %}
        <p><strong>Corrective PR:</strong> Not created (no tests were successfully generated).</p>
        {% else %}
        <p><strong>Corrective PR:</strong> Not needed. Great job!</p>
        {% endif %}
    </div>

    {% if state.survived_mutations %}
    <h2>Survived Mutations & Generated Tests</h2>
    {% for mutation, test in zip(state.survived_mutations, state.generated_tests) %}
    <div class="card">
        <h3>Mutation in <code>{{ mutation.file_path }}</code></h3>
        <p><strong>Original Code:</strong></p>
        <pre><code>{{ mutation.original_code }}</code></pre>
        <p><strong>Survived as:</strong></p>
        <pre><code>{{ mutation.mutated_code }}</code></pre>
        <hr>
        <p><strong>Generated Test for <code>{{ test.target_test_file }}</code>:</strong></p>
        <pre><code>{{ test.generated_test_code }}</code></pre>
    </div>
    {% endfor %}
    {% endif %}
    {% endif %}
</body>
</html>